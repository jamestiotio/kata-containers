<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1628" height="1038" contentStyleType="text/css" preserveAspectRatio="none" style="width:1628px;height:1038px;background:#fff" version="1.1" viewBox="0 0 1628 1038" zoomAndPan="magnify"><g><rect width="10" height="947.984" x="267" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="447" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="617" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="728" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="948" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="1208" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="1356" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="272" x2="272" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="451.5" x2="451.5" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="622" x2="622" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="733" x2="733" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="953" x2="953" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="1212.5" x2="1212.5" y1="36.297" y2="1003.281"/><line style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5" x1="1361" x2="1361" y1="36.297" y2="1003.281"/><rect width="90" height="30.297" x="227" y="5" fill="orange" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="234" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76">hypervisor</text><rect width="90" height="30.297" x="227" y="1002.281" fill="orange" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="234" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76">hypervisor</text><rect width="113" height="30.297" x="395.5" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="402.5" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99">sandbox start</text><rect width="113" height="30.297" x="395.5" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="402.5" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99">sandbox start</text><rect width="56" height="30.297" x="594" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="601" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42">agent</text><rect width="56" height="30.297" x="594" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="601" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42">agent</text><rect width="146" height="30.297" x="660" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="667" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132">resource_manager</text><rect width="146" height="30.297" x="660" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="667" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132">resource_manager</text><rect width="190" height="30.297" x="858" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="865" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176">resource_manager_inner</text><rect width="190" height="30.297" x="858" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="865" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176">resource_manager_inner</text><rect width="73" height="30.297" x="1176.5" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="1183.5" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59">share_fs</text><rect width="73" height="30.297" x="1176.5" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="1183.5" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59">share_fs</text><rect width="74" height="30.297" x="1324" y="5" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="1331" y="24.995" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60">network</text><rect width="74" height="30.297" x="1324" y="1002.281" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="1331" y="1022.276" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60">network</text><rect width="10" height="947.984" x="267" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="447" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="617" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="728" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="948" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="1208" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><rect width="10" height="947.984" x="1356" fill="#FFF" style="stroke:#181818;stroke-width:1" y="46.297"/><polygon fill="#181818" points="288 63.43 278 67.43 288 71.43 284 67.43" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="446" y1="67.43" y2="67.43"/><text x="294" y="62.364" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">1</text><text x="307" y="62.364" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88">prepare_vm()</text><path fill="#FEFFDD" d="M5,80.4297 L5,105.4297 L540,105.4297 L540,90.4297 L530,80.4297 L5,80.4297" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M530,80.4297 L530,90.4297 L540,90.4297 L530,80.4297" style="stroke:#181818;stroke-width:.5"/><text x="11" y="97.497" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="514">fill the hypervisor struct,set the vmm state, or anything needed before start vm</text><polygon fill="#181818" points="716 127.695 726 131.695 716 135.695 720 131.695" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="457" x2="722" y1="131.695" y2="131.695"/><text x="464" y="126.629" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">2</text><text x="477" y="126.629" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174">prepare_before_start_vm()</text><polygon fill="#181818" points="936 156.828 946 160.828 936 164.828 940 160.828" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="738" x2="942" y1="160.828" y2="160.828"/><text x="745" y="155.762" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8">3</text><text x="757" y="155.762" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174">prepare_before_start_vm()</text><polygon fill="#181818" points="1196 185.961 1206 189.961 1196 193.961 1200 189.961" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1202" y1="189.961" y2="189.961"/><text x="965" y="184.895" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">4</text><text x="978" y="184.895" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213">setup_device_before_start_vm ()</text><line style="stroke:#181818;stroke-width:1" x1="1218" x2="1260" y1="219.094" y2="219.094"/><line style="stroke:#181818;stroke-width:1" x1="1260" x2="1260" y1="219.094" y2="232.094"/><line style="stroke:#181818;stroke-width:1" x1="1219" x2="1260" y1="232.094" y2="232.094"/><polygon fill="#181818" points="1229 228.094 1219 232.094 1229 236.094 1225 232.094" style="stroke:#181818;stroke-width:1"/><text x="1225" y="214.028" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">5</text><text x="1238" y="214.028" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111">prepare_virtiofs()</text><path fill="#FEFFDD" d="M1125,245.0938 L1125,270.0938 L1301,270.0938 L1301,255.0938 L1291,245.0938 L1125,245.0938" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1291,245.0938 L1291,255.0938 L1301,255.0938 L1291,245.0938" style="stroke:#181818;stroke-width:.5"/><text x="1131" y="262.161" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155">prepare share_fs device</text><polygon fill="#181818" points="288 292.359 278 296.359 288 300.359 284 296.359" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="1207" y1="296.359" y2="296.359"/><text x="294" y="291.293" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">6</text><text x="307" y="291.293" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83">add_device()</text><path fill="#FEFFDD" d="M1078,309.3594 L1078,334.3594 L1347,334.3594 L1347,319.3594 L1337,309.3594 L1078,309.3594" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1337,309.3594 L1337,319.3594 L1347,319.3594 L1337,309.3594" style="stroke:#181818;stroke-width:.5"/><text x="1084" y="326.426" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248">add share_fs device to the pending list</text><polygon fill="#181818" points="1344 356.625 1354 360.625 1344 364.625 1348 360.625" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1350" y1="360.625" y2="360.625"/><text x="965" y="355.559" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">7</text><text x="978" y="355.559" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37">new()</text><path fill="#FEFFDD" d="M1101,373.625 L1101,398.625 L1621,398.625 L1621,383.625 L1611,373.625 L1101,373.625" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1611,373.625 L1611,383.625 L1621,383.625 L1611,373.625" style="stroke:#181818;stroke-width:.5"/><text x="1107" y="390.692" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="499">scan the network namespace to get the endpoint and create the network pair</text><polygon fill="#181818" points="1344 420.891 1354 424.891 1344 428.891 1348 424.891" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1350" y1="424.891" y2="424.891"/><text x="965" y="419.825" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">8</text><text x="978" y="419.825" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46">setup()</text><path fill="#FEFFDD" d="M1199,437.8906 L1199,462.8906 L1522,462.8906 L1522,447.8906 L1512,437.8906 L1199,437.8906" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1512,437.8906 L1512,447.8906 L1522,447.8906 L1512,437.8906" style="stroke:#181818;stroke-width:.5"/><text x="1205" y="454.957" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302">setup the network model for each network pair</text><polygon fill="#181818" points="288 485.156 278 489.156 288 493.156 284 489.156" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="1355" y1="489.156" y2="489.156"/><text x="294" y="484.09" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9">9</text><text x="307" y="484.09" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83">add_device()</text><path fill="#FEFFDD" d="M1214,502.1563 L1214,527.1563 L1507,527.1563 L1507,512.1563 L1497,502.1563 L1214,502.1563" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1497,502.1563 L1497,512.1563 L1507,512.1563 L1497,502.1563" style="stroke:#181818;stroke-width:.5"/><text x="1220" y="519.223" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272">add tap/Macvtap device to the pending list</text><polygon fill="#181818" points="288 549.422 278 553.422 288 557.422 284 553.422" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="446" y1="553.422" y2="553.422"/><text x="294" y="548.356" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19">10</text><text x="317" y="548.356" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68">start_vm()</text><path fill="#FEFFDD" d="M194,566.4219 L194,591.4219 L350,591.4219 L350,576.4219 L340,566.4219 L194,566.4219" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M340,566.4219 L340,576.4219 L350,576.4219 L340,566.4219" style="stroke:#181818;stroke-width:.5"/><text x="200" y="583.489" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135">hypervisor start here</text><polygon fill="#181818" points="288 613.688 278 617.688 288 621.688 284 617.688" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="446" y1="617.688" y2="617.688"/><text x="294" y="612.622" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">11</text><text x="316" y="612.622" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124">get_agent_socket()</text><polygon fill="#181818" points="605 642.82 615 646.82 605 650.82 609 646.82" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="457" x2="611" y1="646.82" y2="646.82"/><text x="464" y="641.754" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">12</text><text x="486" y="641.754" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40">start()</text><polygon fill="#181818" points="716 671.953 726 675.953 716 679.953 720 675.953" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="457" x2="722" y1="675.953" y2="675.953"/><text x="464" y="670.887" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17">13</text><text x="485" y="670.887" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149">setup_after_start_vm()</text><polygon fill="#181818" points="936 701.086 946 705.086 936 709.086 940 705.086" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="738" x2="942" y1="705.086" y2="705.086"/><text x="745" y="700.02" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">14</text><text x="767" y="700.02" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149">setup_after_start_vm()</text><polygon fill="#181818" points="1196 730.219 1206 734.219 1196 738.219 1200 734.219" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1202" y1="734.219" y2="734.219"/><text x="965" y="729.153" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">15</text><text x="987" y="729.153" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198">setup_device_after_start_vm()</text><path fill="#FEFFDD" d="M1160,747.2188 L1160,772.2188 L1265,772.2188 L1265,757.2188 L1255,747.2188 L1160,747.2188" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1255,747.2188 L1255,757.2188 L1265,757.2188 L1255,747.2188" style="stroke:#181818;stroke-width:.5"/><text x="1166" y="764.286" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84">setup virtiofs</text><polygon fill="#181818" points="288 794.484 278 798.484 288 802.484 284 798.484" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="282" x2="1207" y1="798.484" y2="798.484"/><text x="294" y="793.418" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">16</text><text x="316" y="793.418" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83">add_device()</text><path fill="#FEFFDD" d="M1085,811.4844 L1085,836.4844 L1341,836.4844 L1341,821.4844 L1331,811.4844 L1085,811.4844" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1331,811.4844 L1331,821.4844 L1341,821.4844 L1331,811.4844" style="stroke:#181818;stroke-width:.5"/><text x="1091" y="828.551" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235">Share the source path into the guest</text><polygon fill="#181818" points="1344 858.75 1354 862.75 1344 866.75 1348 862.75" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1350" y1="862.75" y2="862.75"/><text x="965" y="857.684" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">17</text><text x="987" y="857.684" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124">handle_interfaces()</text><polygon fill="#181818" points="1344 887.883 1354 891.883 1344 895.883 1348 891.883" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1350" y1="891.883" y2="891.883"/><text x="965" y="886.817" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">18</text><text x="987" y="886.817" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131">handle_neighbours()</text><polygon fill="#181818" points="1344 917.016 1354 921.016 1344 925.016 1348 921.016" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="958" x2="1350" y1="921.016" y2="921.016"/><text x="965" y="915.95" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18">19</text><text x="987" y="915.95" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101">handle_routes()</text><path fill="#FEFFDD" d="M1168,934.0156 L1168,959.0156 L1554,959.0156 L1554,944.0156 L1544,934.0156 L1168,934.0156" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1544,934.0156 L1544,944.0156 L1554,944.0156 L1544,934.0156" style="stroke:#181818;stroke-width:.5"/><text x="1174" y="951.082" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365">Update the network like neighbours, interface and routes</text><polygon fill="#181818" points="605 981.281 615 985.281 605 989.281 609 985.281" style="stroke:#181818;stroke-width:1"/><line style="stroke:#181818;stroke-width:1" x1="457" x2="611" y1="985.281" y2="985.281"/><text x="464" y="980.215" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19">20</text><text x="487" y="980.215" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113">create_sandbox()</text></g></svg>